<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="/bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/bower_components/font-roboto/roboto.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-pages/iron-pages.html">
<link rel="import" href="/bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="/bower_components/firebase-element/firebase-auth.html">
<link rel="import" href="/bower_components/iron-page-url/iron-page-url.html">
<link rel="import" href="/elements/pp-page-layouts/pp-page-layouts.html">
<link rel="import" href="/elements/pp-page-types/pp-page-types.html">
<link rel="import" href="/elements/pp-pages/pp-pages.html">
<dom-module id="pp-dashboard">
  <template>
    <style>
      :host {
        display: block;
        width: 100vw;
        height: 100vh;
        font-family: Roboto;
      }

			iron-pages {
				padding: 20px;
			}

			iron-pages section > :first-child {
				margin-top: 0;
			}

			iron-pages section > :last-child {
				margin-bottom: 0;
			}

			#logout {
				margin: 0;
				border-radius: 0;
			}

			#navigation a {
				display: block;
				color: inherit;
				text-decoration: none;
			}

			#navigation paper-item[selected] {
				font-weight: bold;
			}
    </style>
    <firebase-auth location="https://ss16-page-press.firebaseio.com" user="{{user}}" provider="google" id="auth"></firebase-auth>
    <iron-page-url path="{{path}}" url-space-regex="^/dashboard/"></iron-page-url>
    <paper-drawer-panel force-narrow id="drawerPanel" hidden$="[[!user]]">
      <paper-header-panel drawer>
        <paper-toolbar>
          <div class="title" style="line-height: 22px; margin-left: 0;"><strong><em>PagePress</em></strong>&nbsp;Navigation</div>
        </paper-toolbar>
        <div class="fit vertical layout">
        	<div id="navigation" on-tap="_closeDrawer">
		        <a href="/dashboard/">
		        	<paper-item page="Overview" selected$="[[_equalTo(page, 'Overview')]]">Overview</paper-item>
		        </a>
		        <a href="/dashboard/page-layouts/">
		        	<paper-item page="Page Layouts" selected$="[[_equalTo(page, 'Page Layouts')]]">Page Layouts</paper-item>
		        </a>
		        <a href="/dashboard/page-types/">
		        	<paper-item page="Page Types" selected$="[[_equalTo(page, 'Page Types')]]">Page Types</paper-item>
		        </a>
		        <a href="/dashboard/pages/">
		        	<paper-item page="Pages" selected$="[[_equalTo(page, 'Pages')]]">Pages</paper-item>
		        </a>
		       </div>
	        <div class="flex"></div>
	        <div class="horizontal layout">
	        	<paper-button id="logout" class="flex" on-tap="logout">Log Out</paper-button>
	        </div>
        </div>
      </paper-header-panel>
      <paper-header-panel main>
        <paper-toolbar>
          <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
          <div class="title" style="line-height: 22px;"><strong><em>PagePress</em></strong>&nbsp;Dashboard</div>
        </paper-toolbar>
        <iron-pages selected="[[page]]" attr-for-selected="page">
        	<section page="Overview">
        		<h1>Overview</h1>
        		<p>Welcome!  PagePress aims to be a content management system (CMS) reimagined as a single-page application (SPA).</p>
        	</section>
        	<section page="Page Layouts">
        		<div class="horizontal layout">
        			<h1 class="self-center">Page Layouts</h1>
        			<paper-icon-button icon="help" class="self-center"></paper-icon-button>
        		</div>
        		<pp-page-layouts></pp-page-layouts>
        	</section>
        	<section page="Page Types">
        		<div class="horizontal layout">
        			<h1 class="self-center">Page Types</h1>
        			<paper-icon-button icon="help" class="self-center"></paper-icon-button>
        		</div>
        		<pp-page-types></pp-page-types>
        	</section>
        	<section page="Pages">
        		<div class="horizontal layout">
        			<h1 class="self-center">Pages</h1>
        			<paper-icon-button icon="help" class="self-center"></paper-icon-button>
        		</div>
        		<pp-pages></pp-pages>
        	</section>
        </iron-pages>
      </paper-header-panel>
    </paper-drawer-panel>
    <div class="fit horizontal layout center-justified" hidden$="[[user]]" id="login-backdrop">
    	<paper-button class="self-center" raised on-tap="login" id="login-button">Log In</paper-button>
    </div>
  </template>
  <script>
    Polymer(
      {
        is: 'pp-dashboard',
        properties: {
					path: {
						type: String,
						observer: '_pathChanged'
					},
        	page: {
        		type: String
        	},
        	user: {
        		type: Object
        	}
        },
				login: function () {
					if (!this.user) this.$.auth.ref.authWithOAuthPopup(
						'google',
						function () {},
						{
							remember: 'sessionOnly',
							scope: 'email'
						}
					);
				},
				logout: function () {
					if (this.user) this.$.auth.logout();
				},
        _closeDrawer: function () {
					this.$.drawerPanel.closeDrawer();
        },
        _pathChanged: function () {
					var page = 'Overview';

					switch (this.path) {
						case '/dashboard/page-layouts/':
							page = 'Page Layouts';
							break;
						case '/dashboard/page-types/':
							page = 'Page Types';
							break;
						case '/dashboard/pages/':
							page = 'Pages';
							break;
					}

					this.page = page;
				},
				_equalTo: function (a, b) {
					return a === b;
				}
      }
    );
  </script>
</dom-module>